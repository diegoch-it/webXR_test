{"version":3,"file":"index-CLysP-eu.js","sources":["../../src/main.js"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\n\r\nasync function startAR() {\r\n    try {\r\n        console.log(\"Initializing WebXR...\");\r\n        \r\n        const canvas = document.getElementById(\"canvas\");\r\n        if (!canvas) {\r\n            throw new Error(\"Canvas element not found\");\r\n        }\r\n\r\n        // Ensure canvas has dimensions\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n        \r\n         // Create engine with explicit options to avoid initialization issues\r\n        const engine = new BABYLON.Engine(canvas, true, {\r\n            preserveDrawingBuffer: true,\r\n            stencil: true,\r\n            disableWebGL2Support: false, // Ensure WebGL2 is used if available\r\n            audioEngine: false // Disable audio to reduce complexity\r\n        });\r\n        // Handle engine resize immediately\r\n        window.addEventListener(\"resize\", () => {\r\n            engine.resize();\r\n        });\r\n        \r\n        const scene = new BABYLON.Scene(engine);\r\n        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);\r\n        \r\n        const camera = new BABYLON.FreeCamera(\"camera\", BABYLON.Vector3.Zero(), scene);\r\n        const light = new BABYLON.HemisphericLight(\"light\", new BABYLON.Vector3(0, 1, 0), scene);\r\n        light.intensity = 1;\r\n        \r\n        // Load model first\r\n        console.log(\"Loading model...\");\r\n        let modelMesh = null;\r\n        try {\r\n            const result = await BABYLON.SceneLoader.ImportMeshAsync(\r\n                \"\", \"./\",\r\n                \"arm_chair__furniture.glb\",\r\n                scene\r\n            );\r\n            modelMesh = result.meshes[0];\r\n            modelMesh.setEnabled(false);\r\n            console.log(\"Model loaded successfully\");\r\n        } catch (e) {\r\n            console.error(\"Model loading failed:\", e);\r\n        }\r\n        \r\n        // Start render loop\r\n        engine.runRenderLoop(() => scene.render());\r\n        window.addEventListener(\"resize\", () => engine.resize());\r\n        \r\n        // Create XR helper first without entering XR\r\n        console.log(\"Setting up WebXR...\");\r\n        const xrHelper = await BABYLON.WebXRDefaultExperience.CreateAsync(scene, {\r\n            uiOptions: {\r\n                sessionMode: \"immersive-ar\",\r\n                referenceSpaceType: \"unbounded\",\r\n                onError: (error) => {\r\n                    console.error(\"XR UI Error:\", error);\r\n                }\r\n            },\r\n            // Disable automatic entry into XR\r\n            disableTeleportation: true,\r\n            useStablePlugins: true\r\n        });\r\n        \r\n        let modelPlaced = false;\r\n        \r\n        // Configure features BEFORE entering XR\r\n        const featuresManager = xrHelper.baseExperience.featuresManager;\r\n        \r\n        // Pre-configure hit-test feature (since image tracking isn't working)\r\n        let hitTestFeature = null;\r\n        try {\r\n            hitTestFeature = featuresManager.enableFeature(\r\n                BABYLON.WebXRFeatureName.HIT_TEST,\r\n                \"latest\",\r\n                {\r\n                    offsetRay: {\r\n                        origin: { x: 0, y: 0, z: 0 },\r\n                        direction: { x: 0, y: 0, z: -1 }\r\n                    }\r\n                },\r\n                false, // Don't attach yet\r\n                false  // Optional feature\r\n            );\r\n            console.log(\"Hit-test feature configured\");\r\n        } catch (e) {\r\n            console.log(\"Hit-test configuration failed:\", e);\r\n        }\r\n        \r\n        // Create placement indicator\r\n        const indicator = BABYLON.MeshBuilder.CreateTorus(\"indicator\", {\r\n            diameter: 0.15,\r\n            thickness: 0.01\r\n        }, scene);\r\n        const indicatorMat = new BABYLON.StandardMaterial(\"indicatorMat\", scene);\r\n        indicatorMat.emissiveColor = new BABYLON.Color3(0, 1, 0);\r\n        indicatorMat.alpha = 0.7;\r\n        indicator.material = indicatorMat;\r\n        indicator.setEnabled(false);\r\n        \r\n        // Set up session event handlers\r\n        xrHelper.baseExperience.sessionManager.onXRSessionInit.add((xrSession) => {\r\n            console.log(\"AR Session started!\");\r\n            \r\n            // Now attach the hit-test feature\r\n            if (hitTestFeature) {\r\n                try {\r\n                    // Set up hit-test observable\r\n                    hitTestFeature.onHitTestResultObservable.add((results) => {\r\n                        if (results.length > 0 && !modelPlaced) {\r\n                            const result = results[0];\r\n                            indicator.setEnabled(true);\r\n                            \r\n                            // Use the transformation matrix directly\r\n                            if (result.transformationMatrix) {\r\n                                const matrix = result.transformationMatrix;\r\n                                const position = new BABYLON.Vector3();\r\n                                const quaternion = new BABYLON.Quaternion();\r\n                                const scale = new BABYLON.Vector3();\r\n                                matrix.decompose(scale, quaternion, position);\r\n                                \r\n                                indicator.position = position;\r\n                                indicator.rotationQuaternion = quaternion;\r\n                            } else {\r\n                                indicator.position = result.position;\r\n                                indicator.rotationQuaternion = result.rotationQuaternion;\r\n                            }\r\n                        } else if (modelPlaced) {\r\n                            indicator.setEnabled(false);\r\n                        }\r\n                    });\r\n                    \r\n                    console.log(\"Hit-test activated\");\r\n                } catch (e) {\r\n                    console.error(\"Hit-test activation error:\", e);\r\n                }\r\n            }\r\n            \r\n            // If no features work, place model directly after a delay\r\n            if (!hitTestFeature && modelMesh) {\r\n                setTimeout(() => {\r\n                    if (!modelPlaced) {\r\n                        console.log(\"Placing model at fixed position\");\r\n                        modelMesh.setEnabled(true);\r\n                        modelMesh.position = new BABYLON.Vector3(0, -0.5, -2);\r\n                        modelMesh.scaling.setAll(0.1);\r\n                        modelPlaced = true;\r\n                    }\r\n                }, 1000);\r\n            }\r\n        });\r\n        \r\n        // Handle tap to place model\r\n        scene.onPointerObservable.add((pointerInfo) => {\r\n            if (pointerInfo.type === BABYLON.PointerEventTypes.POINTERDOWN) {\r\n                // Check if we're in an XR session\r\n                if (!xrHelper.baseExperience.sessionManager.session) {\r\n                    return;\r\n                }\r\n                \r\n                if (!modelPlaced && indicator.isEnabled && modelMesh) {\r\n                    // Place the model\r\n                    modelMesh.setEnabled(true);\r\n                    modelMesh.position = indicator.position.clone();\r\n                    modelMesh.rotationQuaternion = indicator.rotationQuaternion ? \r\n                        indicator.rotationQuaternion.clone() : \r\n                        BABYLON.Quaternion.Identity();\r\n                    modelMesh.scaling.setAll(0.1);\r\n                    modelPlaced = true;\r\n                    indicator.setEnabled(false);\r\n                    console.log(\"Model placed!\");\r\n                } else if (modelPlaced && modelMesh) {\r\n                    // Rotate the model\r\n                    modelMesh.rotation.y += 0.4;\r\n                    console.log(\"Model rotated\");\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Add floating animation\r\n        scene.registerBeforeRender(() => {\r\n            if (modelPlaced && modelMesh && modelMesh.isEnabled()) {\r\n                const time = performance.now() * 0.001;\r\n                modelMesh.position.y += Math.sin(time * 2) * 0.0005;\r\n            }\r\n        });\r\n        \r\n        console.log(\"WebXR initialized successfully\");\r\n        console.log(\"Click the AR button to start the session\");\r\n        \r\n    } catch (error) {\r\n        console.error(\"AR initialization failed:\", error);\r\n        document.body.innerHTML = `\r\n            <div style=\"padding: 20px; background: white; color: red;\">\r\n                <h2>AR Initialization Error</h2>\r\n                <p>${error.message}</p>\r\n                <p>Please check the console for details</p>\r\n            </div>\r\n        `;\r\n    }\r\n}\r\n\r\n// Start when DOM is ready\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', startAR);\r\n} else {\r\n    startAR();\r\n}"],"names":["startAR","canvas","engine","BABYLON.Engine","scene","BABYLON.Scene","BABYLON.Color4","camera","BABYLON.FreeCamera","BABYLON.Vector3","light","BABYLON.HemisphericLight","modelMesh","BABYLON.SceneLoader","e","xrHelper","BABYLON.WebXRDefaultExperience","error","modelPlaced","featuresManager","hitTestFeature","BABYLON.WebXRFeatureName","indicator","BABYLON.MeshBuilder","indicatorMat","BABYLON.StandardMaterial","BABYLON.Color3","xrSession","results","result","matrix","position","quaternion","BABYLON.Quaternion","scale","pointerInfo","BABYLON.PointerEventTypes","time"],"mappings":"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"}