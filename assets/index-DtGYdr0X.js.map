{"version":3,"file":"index-DtGYdr0X.js","sources":["../../src/main.js"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\n\r\nasync function startAR() {\r\n    try {\r\n        console.log(\"Starting AR initialization...\");\r\n        \r\n        // Get canvas element - make sure this ID matches your HTML\r\n        const canvas = document.getElementById(\"renderCanvas\");\r\n        if (!canvas) {\r\n            throw new Error(\"Canvas element with id 'renderCanvas' not found\");\r\n        }\r\n        \r\n        const engine = new BABYLON.Engine(canvas, true);\r\n        const scene = new BABYLON.Scene(engine);\r\n        \r\n        // Set transparent background for AR\r\n        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);\r\n        \r\n        // Create camera\r\n        const camera = new BABYLON.FreeCamera(\"camera\", new BABYLON.Vector3(0, 0, 0), scene);\r\n        \r\n        // Add light to the scene\r\n        const light = new BABYLON.HemisphericLight(\"light\", new BABYLON.Vector3(0, 1, 0), scene);\r\n        light.intensity = 1;\r\n        \r\n        console.log(\"Checking WebXR support...\");\r\n        \r\n        // Check if WebXR is supported\r\n        const xrSupported = await BABYLON.WebXRSessionManager.IsSessionSupportedAsync('immersive-ar');\r\n        if (!xrSupported) {\r\n            throw new Error(\"WebXR AR is not supported on this device/browser\");\r\n        }\r\n        \r\n        console.log(\"Creating XR experience...\");\r\n        \r\n        // Create XR experience\r\n        const xr = await scene.createDefaultXRExperienceAsync({\r\n            uiOptions: {\r\n                sessionMode: \"immersive-ar\",\r\n                referenceSpaceType: \"local\"\r\n            },\r\n            optionalFeatures: true\r\n        });\r\n        \r\n        console.log(\"Enabling image tracking...\");\r\n        \r\n        // Enable image tracking\r\n        const fm = xr.baseExperience.featuresManager;\r\n        const imageTracking = fm.enableFeature(\r\n            BABYLON.WebXRFeatureName.IMAGE_TRACKING,\r\n            \"latest\",\r\n            {\r\n                images: [\r\n                    {\r\n                        src: \"./furniture.jpg\", // Updated to match your actual file\r\n                        estimatedRealWorldWidth: 0.2 // 20cm width - adjust based on your actual image size\r\n                    }\r\n                ]\r\n            }\r\n        );\r\n        \r\n        let modelMesh = null;\r\n        let anchorFound = false;\r\n        \r\n        console.log(\"Loading 3D model...\");\r\n        \r\n        // Load the 3D model\r\n        try {\r\n            const container = await BABYLON.SceneLoader.LoadAssetContainerAsync(\r\n                \"\", \r\n                \"arm_chair__furniture.glb\", // ensures GH Pages works\r\n                scene\r\n            );\r\n            container.addAllToScene();  \r\n\r\n\r\n            \r\n            modelMesh = container.meshes[0];\r\n            // modelMesh.scaling = new BABYLON.Vector3(1, 1, 1);\r\n            // modelMesh.setEnabled(false); // Hide initially\r\n            \r\n            console.log(\"Model loaded successfully\");\r\n        } catch (modelError) {\r\n            console.error(\"Error loading model:\", modelError);\r\n            throw new Error(\"Failed to load 3D model: \" + modelError.message);\r\n        }\r\n        \r\n        // Simple \"floating\" animation\r\n        scene.onBeforeRenderObservable.add(() => {\r\n            if (anchorFound && modelMesh) {\r\n                modelMesh.position.y += Math.sin(performance.now() * 0.002) * 0.01;\r\n            }\r\n        });\r\n        \r\n        // Image tracking event handler\r\n        imageTracking.onTrackedImageUpdatedObservable.add((image) => {\r\n            if (!modelMesh) return;\r\n            \r\n            console.log(\"Image tracking state:\", image.trackingState);\r\n            \r\n            if (image.trackingState === 'tracked') {\r\n                modelMesh.setEnabled(true);\r\n                anchorFound = true;\r\n                \r\n                // Get transformation from the tracked image\r\n                const matrix = image.transformationMatrix;\r\n                const position = new BABYLON.Vector3();\r\n                const rotation = new BABYLON.Quaternion();\r\n                const scale = new BABYLON.Vector3();\r\n                \r\n                matrix.decompose(scale, rotation, position);\r\n                \r\n                // Apply position and rotation\r\n                modelMesh.position = position;\r\n                modelMesh.rotationQuaternion = rotation;\r\n                \r\n                // Set appropriate scale for your model\r\n                modelMesh.scaling.setAll(0.1); // Adjust this value based on your model size\r\n            } else {\r\n                // Hide model when tracking is lost\r\n                modelMesh.setEnabled(false);\r\n                anchorFound = false;\r\n            }\r\n        });\r\n        \r\n        // Tap interaction: rotate the model\r\n        scene.onPointerObservable.add((pointerInfo) => {\r\n            if (!anchorFound || !modelMesh) return;\r\n            \r\n            if (pointerInfo.type === BABYLON.PointerEventTypes.POINTERDOWN) {\r\n                const pickResult = scene.pick(\r\n                    scene.pointerX, \r\n                    scene.pointerY\r\n                );\r\n                \r\n                if (pickResult.hit && pickResult.pickedMesh === modelMesh) {\r\n                    modelMesh.rotation.y += 0.4;\r\n                    console.log(\"Model rotated\");\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Start render loop\r\n        engine.runRenderLoop(() => {\r\n            scene.render();\r\n        });\r\n        \r\n        // Handle window resize\r\n        window.addEventListener(\"resize\", () => {\r\n            engine.resize();\r\n        });\r\n        \r\n        console.log(\"AR initialization complete\");\r\n        \r\n    } catch (error) {\r\n        console.error(\"AR initialization failed:\", error);\r\n        showError(error.message);\r\n    }\r\n}\r\n\r\n// Error display function\r\nfunction showError(message) {\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.style.cssText = `\r\n        position: fixed;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        background: rgba(255, 0, 0, 0.9);\r\n        color: white;\r\n        padding: 20px;\r\n        border-radius: 10px;\r\n        font-family: Arial, sans-serif;\r\n        z-index: 10000;\r\n        max-width: 80%;\r\n        text-align: center;\r\n    `;\r\n    errorDiv.innerHTML = `\r\n        <h3>AR Initialization Error</h3>\r\n        <p>${message}</p>\r\n        <p style=\"font-size: 0.9em; margin-top: 10px;\">\r\n            Check the browser console for more details (F12)\r\n        </p>\r\n    `;\r\n    document.body.appendChild(errorDiv);\r\n}\r\n\r\n// Start AR when page is loaded\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', startAR);\r\n} else {\r\n    startAR();\r\n}\r\n"],"names":["startAR","canvas","engine","BABYLON.Engine","scene","BABYLON.Scene","BABYLON.Color4","camera","BABYLON.FreeCamera","BABYLON.Vector3","light","BABYLON.HemisphericLight","BABYLON.WebXRSessionManager","xr","imageTracking","BABYLON.WebXRFeatureName","modelMesh","anchorFound","container","BABYLON.SceneLoader","modelError","image","matrix","position","rotation","BABYLON.Quaternion","scale","pointerInfo","BABYLON.PointerEventTypes","pickResult","error","showError","message","errorDiv"],"mappings":"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"}