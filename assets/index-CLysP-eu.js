import{E as v,S as R,C as L,F as S,V as c,H as x,a as O,W as P,b as T,M as C,c as H,d as z,Q as b,P as A}from"./babylon-2-vpsqP5.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))g(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const l of e.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&g(l)}).observe(document,{childList:!0,subtree:!0});function n(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function g(t){if(t.ep)return;t.ep=!0;const e=n(t);fetch(t.href,e)}})();async function y(){try{console.log("Initializing WebXR...");const i=document.getElementById("canvas");if(!i)throw new Error("Canvas element not found");i.width=window.innerWidth,i.height=window.innerHeight;const s=new v(i,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1,audioEngine:!1});window.addEventListener("resize",()=>{s.resize()});const n=new R(s);n.clearColor=new L(0,0,0,0);const g=new S("camera",c.Zero(),n),t=new x("light",new c(0,1,0),n);t.intensity=1,console.log("Loading model...");let e=null;try{e=(await O.ImportMeshAsync("","./","arm_chair__furniture.glb",n)).meshes[0],e.setEnabled(!1),console.log("Model loaded successfully")}catch(r){console.error("Model loading failed:",r)}s.runRenderLoop(()=>n.render()),window.addEventListener("resize",()=>s.resize()),console.log("Setting up WebXR...");const l=await P.CreateAsync(n,{uiOptions:{sessionMode:"immersive-ar",referenceSpaceType:"unbounded",onError:r=>{console.error("XR UI Error:",r)}},disableTeleportation:!0,useStablePlugins:!0});let a=!1;const w=l.baseExperience.featuresManager;let d=null;try{d=w.enableFeature(T.HIT_TEST,"latest",{offsetRay:{origin:{x:0,y:0,z:0},direction:{x:0,y:0,z:-1}}},!1,!1),console.log("Hit-test feature configured")}catch(r){console.log("Hit-test configuration failed:",r)}const o=C.CreateTorus("indicator",{diameter:.15,thickness:.01},n),p=new H("indicatorMat",n);p.emissiveColor=new z(0,1,0),p.alpha=.7,o.material=p,o.setEnabled(!1),l.baseExperience.sessionManager.onXRSessionInit.add(r=>{if(console.log("AR Session started!"),d)try{d.onHitTestResultObservable.add(u=>{if(u.length>0&&!a){const f=u[0];if(o.setEnabled(!0),f.transformationMatrix){const E=f.transformationMatrix,m=new c,h=new b,M=new c;E.decompose(M,h,m),o.position=m,o.rotationQuaternion=h}else o.position=f.position,o.rotationQuaternion=f.rotationQuaternion}else a&&o.setEnabled(!1)}),console.log("Hit-test activated")}catch(u){console.error("Hit-test activation error:",u)}!d&&e&&setTimeout(()=>{a||(console.log("Placing model at fixed position"),e.setEnabled(!0),e.position=new c(0,-.5,-2),e.scaling.setAll(.1),a=!0)},1e3)}),n.onPointerObservable.add(r=>{if(r.type===A.POINTERDOWN){if(!l.baseExperience.sessionManager.session)return;!a&&o.isEnabled&&e?(e.setEnabled(!0),e.position=o.position.clone(),e.rotationQuaternion=o.rotationQuaternion?o.rotationQuaternion.clone():b.Identity(),e.scaling.setAll(.1),a=!0,o.setEnabled(!1),console.log("Model placed!")):a&&e&&(e.rotation.y+=.4,console.log("Model rotated"))}}),n.registerBeforeRender(()=>{if(a&&e&&e.isEnabled()){const r=performance.now()*.001;e.position.y+=Math.sin(r*2)*5e-4}}),console.log("WebXR initialized successfully"),console.log("Click the AR button to start the session")}catch(i){console.error("AR initialization failed:",i),document.body.innerHTML=`
            <div style="padding: 20px; background: white; color: red;">
                <h2>AR Initialization Error</h2>
                <p>${i.message}</p>
                <p>Please check the console for details</p>
            </div>
        `}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();
//# sourceMappingURL=index-CLysP-eu.js.map
