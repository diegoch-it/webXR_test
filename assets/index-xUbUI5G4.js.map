{"version":3,"file":"index-xUbUI5G4.js","sources":["../../src/main.js"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\n\r\nasync function startAR() {\r\n    try {\r\n        // Wait for DOM to be fully ready\r\n        if (document.readyState !== 'complete') {\r\n            await new Promise(resolve => window.addEventListener('load', resolve));\r\n        }\r\n        \r\n        const canvas = document.getElementById(\"canvas\");\r\n        if (!canvas) {\r\n            throw new Error(\"Canvas element not found\");\r\n        }\r\n        \r\n        // Ensure canvas has dimensions\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n        \r\n        // Create engine with explicit options to avoid initialization issues\r\n        const engine = new BABYLON.Engine(canvas, true, {\r\n            preserveDrawingBuffer: true,\r\n            stencil: true,\r\n            disableWebGL2Support: false, // Ensure WebGL2 is used if available\r\n            audioEngine: false // Disable audio to reduce complexity\r\n        });\r\n        \r\n        // Handle engine resize immediately\r\n        window.addEventListener(\"resize\", () => {\r\n            engine.resize();\r\n        });\r\n        \r\n        const scene = new BABYLON.Scene(engine);\r\n        \r\n        // Explicitly set scene clear color\r\n        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);\r\n        \r\n        // Create camera with proper initialization\r\n        const camera = new BABYLON.FreeCamera(\r\n            \"camera\", \r\n            BABYLON.Vector3.Zero(), \r\n            scene\r\n        );\r\n        camera.attachControl(canvas, true);\r\n        \r\n        // Add light\r\n        const light = new BABYLON.HemisphericLight(\r\n            \"light\", \r\n            new BABYLON.Vector3(0, 1, 0), \r\n            scene\r\n        );\r\n        light.intensity = 1;\r\n        \r\n        let modelMesh = null;\r\n        let modelPlaced = false;\r\n        \r\n        // Load model before XR initialization\r\n        try {\r\n            console.log(\"Loading 3D model...\");\r\n            const result = await BABYLON.SceneLoader.ImportMeshAsync(\r\n                \"\", \r\n                \"./\",\r\n                \"arm_chair__furniture.glb\",\r\n                scene\r\n            );\r\n            \r\n            modelMesh = result.meshes[0];\r\n            modelMesh.setEnabled(false);\r\n            console.log(\"Model loaded successfully\");\r\n        } catch (modelError) {\r\n            console.error(\"Error loading model:\", modelError);\r\n            // Continue without model for testing\r\n        }\r\n        \r\n        // Start render loop before XR\r\n        engine.runRenderLoop(() => {\r\n            scene.render();\r\n        });\r\n        \r\n        console.log(\"Initializing WebXR...\");\r\n        \r\n        // Initialize WebXR with try-catch\r\n        try {\r\n            const xr = await scene.createDefaultXRExperienceAsync({\r\n                uiOptions: {\r\n                    sessionMode: \"immersive-ar\",\r\n                    referenceSpaceType: \"unbounded\"\r\n                },\r\n                optionalFeatures: true\r\n            });\r\n            \r\n            // Setup XR features when session starts\r\n            xr.baseExperience.sessionManager.onXRSessionInit.add(() => {\r\n                console.log(\"AR Session started!\");\r\n                \r\n                const featuresManager = xr.baseExperience.featuresManager;\r\n                \r\n                // Try image tracking first (optional)\r\n                try {\r\n                    const imageTracking = featuresManager.enableFeature(\r\n                        BABYLON.WebXRFeatureName.IMAGE_TRACKING,\r\n                        \"latest\",\r\n                        {\r\n                            images: [\r\n                                {\r\n                                    src: \"./furniture.jpg\",\r\n                                    estimatedRealWorldWidth: 0.085\r\n                                }\r\n                            ]\r\n                        },\r\n                        false,\r\n                        false\r\n                    );\r\n                    \r\n                    if (imageTracking) {\r\n                        console.log(\"Image tracking enabled\");\r\n                        \r\n                        imageTracking.onTrackedImageUpdatedObservable.add(image => {\r\n                            if (!modelMesh) return;\r\n                            \r\n                            const pose = image.realWorldTransform;\r\n                            if (pose) {\r\n                                modelMesh.setEnabled(true);\r\n                                modelPlaced = true;\r\n                                modelMesh.position.copyFrom(pose.position);\r\n                                modelMesh.rotationQuaternion = pose.rotationQuaternion;\r\n                                modelMesh.scaling.setAll(0.1);\r\n                                console.log(\"Image tracked!\");\r\n                            }\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.log(\"Image tracking not available\");\r\n                }\r\n                \r\n                // Fallback to hit-test\r\n                try {\r\n                    const hitTest = featuresManager.enableFeature(\r\n                        BABYLON.WebXRFeatureName.HIT_TEST,\r\n                        \"latest\",\r\n                        {\r\n                            offsetRay: {\r\n                                origin: { x: 0, y: 0, z: 0 },\r\n                                direction: { x: 0, y: 0, z: -1 }\r\n                            }\r\n                        },\r\n                        false,\r\n                        false\r\n                    );\r\n                    \r\n                    if (hitTest) {\r\n                        console.log(\"Hit-test enabled\");\r\n                        \r\n                        // Create placement indicator\r\n                        const indicator = BABYLON.MeshBuilder.CreateTorus(\"indicator\", {\r\n                            diameter: 0.15,\r\n                            thickness: 0.01\r\n                        }, scene);\r\n                        \r\n                        const indicatorMaterial = new BABYLON.StandardMaterial(\"indicatorMat\", scene);\r\n                        indicatorMaterial.emissiveColor = new BABYLON.Color3(0, 1, 0);\r\n                        indicator.material = indicatorMaterial;\r\n                        indicator.isVisible = false;\r\n                        \r\n                        // Update indicator with hit results\r\n                        hitTest.onHitTestResultObservable.add((results) => {\r\n                            if (results.length > 0) {\r\n                                indicator.isVisible = true;\r\n                                indicator.position = results[0].position;\r\n                                indicator.rotationQuaternion = results[0].rotationQuaternion;\r\n                            } else {\r\n                                indicator.isVisible = false;\r\n                            }\r\n                        });\r\n                        \r\n                        // Place model on tap\r\n                        const pointerObserver = scene.onPointerObservable.add((pointerInfo) => {\r\n                            if (pointerInfo.type === BABYLON.PointerEventTypes.POINTERDOWN) {\r\n                                if (!modelPlaced && indicator.isVisible && modelMesh) {\r\n                                    modelMesh.setEnabled(true);\r\n                                    modelMesh.position = indicator.position.clone();\r\n                                    modelMesh.rotationQuaternion = indicator.rotationQuaternion.clone();\r\n                                    modelMesh.scaling.setAll(0.1);\r\n                                    modelPlaced = true;\r\n                                    indicator.isVisible = false;\r\n                                    console.log(\"Model placed!\");\r\n                                } else if (modelPlaced && modelMesh) {\r\n                                    modelMesh.rotation.y += 0.4;\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.log(\"Hit-test not available\");\r\n                    \r\n                    // Final fallback: place model directly\r\n                    if (modelMesh) {\r\n                        setTimeout(() => {\r\n                            if (!modelPlaced) {\r\n                                modelMesh.setEnabled(true);\r\n                                modelMesh.position = new BABYLON.Vector3(0, -0.5, -2);\r\n                                modelMesh.scaling.setAll(0.1);\r\n                                modelPlaced = true;\r\n                                console.log(\"Model placed at fixed position\");\r\n                            }\r\n                        }, 2000);\r\n                    }\r\n                }\r\n            });\r\n            \r\n            console.log(\"WebXR initialized successfully\");\r\n            \r\n        } catch (xrError) {\r\n            console.error(\"WebXR not available:\", xrError);\r\n            // Non-AR fallback\r\n            if (modelMesh) {\r\n                modelMesh.setEnabled(true);\r\n                modelMesh.position = new BABYLON.Vector3(0, 0, 5);\r\n                modelMesh.scaling.setAll(1);\r\n                scene.clearColor = new BABYLON.Color4(0.2, 0.2, 0.2, 1);\r\n            }\r\n        }\r\n        \r\n        // Add floating animation\r\n        scene.registerBeforeRender(() => {\r\n            if (modelPlaced && modelMesh) {\r\n                modelMesh.position.y += Math.sin(performance.now() * 0.002) * 0.001;\r\n            }\r\n        });\r\n        \r\n        console.log(\"AR initialization complete\");\r\n        \r\n    } catch (error) {\r\n        console.error(\"Fatal error:\", error);\r\n        document.body.innerHTML = `\r\n            <div style=\"padding: 20px; color: red;\">\r\n                <h2>Error</h2>\r\n                <p>${error.message}</p>\r\n                <p>Check console for details</p>\r\n            </div>\r\n        `;\r\n    }\r\n}\r\n\r\n// Ensure proper initialization timing\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', startAR);\r\n} else {\r\n    startAR();\r\n}"],"names":["startAR","resolve","canvas","engine","BABYLON.Engine","scene","BABYLON.Scene","BABYLON.Color4","BABYLON.FreeCamera","BABYLON.Vector3","light","BABYLON.HemisphericLight","modelMesh","modelPlaced","BABYLON.SceneLoader","modelError","xr","featuresManager","imageTracking","BABYLON.WebXRFeatureName","image","pose","hitTest","indicator","BABYLON.MeshBuilder","indicatorMaterial","BABYLON.StandardMaterial","BABYLON.Color3","results","pointerObserver","pointerInfo","BABYLON.PointerEventTypes","xrError","error"],"mappings":"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"}